import{af as W,ab as pe,ac as he,ad as ce,ae as V,ao as fe,r as k,ap as ge,aq as Ne,b as _e,R as be,at as j,j as h,S,a as n,g as we,B as Y,T as N,n as ae,U as K,A as J,au as M,av as rn,aw as on,ax as w,C as F,f as Ce,ay as Re,az as sn,H as qe,bC as an,aG as cn,aI as Z,aJ as dn,bD as ln,F as ve,bE as le,aM as mn,aN as un,i as me,k as Se,aH as ie,aP as Fe,l as Te,M as ue,aS as Me,u as Ue,ar as pn,aK as hn,bF as fn,bG as gn,bh as _n,bH as bn}from"./index.b3b82eb3.js";import{C as T,u as Cn}from"./get-list-caretakers.api.fa2cace3.js";import{P as B,C as Sn,u as ze}from"./patient-endpoint.36464126.js";import{e as Tn,m as D,u as ee}from"./confirm-password.validation.fea8be59.js";import{p as yn,u as O,a as Qe}from"./profile.validation.ad7e7eae.js";import{u as xn,P as An,T as Ge}from"./table.1bced37e.js";import{a as He,C as Ye,d as Pn,F as ne}from"./form.5084ebc2.js";import{F as In}from"./file-upload.7eb0e642.js";import{u as Be,A as We,b as kn,c as Oe}from"./additional-feature.294219f4.js";import{M as En}from"./modal-base.91f8d918.js";import{P as se}from"./permission-check.51974c0f.js";import{H as $e}from"./Head.663b461a.js";import{C as Ln,M as je}from"./change-status-user.9246f232.js";import{C as Ke}from"./chakra-link.98b662c1.js";import{I as Nn,L as wn,A as Rn}from"./index.1677c1d2.js";import{T as qn}from"./index.d4b9fca0.js";import{A as vn,D as Fn}from"./assign-icon.612a5b8e.js";import"./slicedToArray.dcf7c84f.js";import"./index.esm.2b6ea95a.js";import"./popper.824c9986.js";const Mn=t=>V({url:T.CREATE,method:"POST",data:t}),Un=({configs:t}={})=>{const r=W();return pe({mutationFn:Mn,onSuccess(o){var s,a;!o.success||(s=o.data)!=null&&s.message&&(he("SUCCESS",(a=o.data)==null?void 0:a.message),r.refetchQueries([T.LIST]))},onError:o=>{ce(o)},...t})};function zn(){return ge(V({url:T.RELATIONSHIP,method:"get",baseURL:"https://health-magnet-api-dev.adamo.tech/api/"}))}function Qn({configs:t}={}){const{data:r,...o}=fe({...t,queryFn:zn,queryKey:[T.RELATIONSHIP]});return{relationshipList:k.exports.useMemo(()=>r==null?void 0:r.data,[r==null?void 0:r.data]),...o}}function Gn(t){return ge(V({url:T.DETAIL,method:"get",params:{id:t}}))}function Ve({configs:t,id:r,shouldNavigateNotFound:o=!1}){var u;const s=Ne(),{data:a,...e}=fe({enabled:!!r,...t,queryFn:()=>Gn(r),onError(i){((i==null?void 0:i.code)===404||(i==null?void 0:i.statusCode)===404)&&o?s(_e.NOT_FOUND):ce(i)},queryKey:[T.DETAIL,r]}),m=k.exports.useMemo(()=>a==null?void 0:a.carer,[a==null?void 0:a.carer]),C=k.exports.useMemo(()=>{var i;return(i=a==null?void 0:a.carer)==null?void 0:i.patients},[(u=a==null?void 0:a.carer)==null?void 0:u.patients]);return{caretakerDetail:m,patientsOfCaretaker:C,...e,isLoading:e.isLoading&&e.fetchStatus!=="idle"}}const Hn=t=>V({url:T.ASSIGN_CARETAKER_TO_PATIENT,method:"POST",data:t}),Je=({configs:t}={})=>{const r=W();return pe({mutationFn:Hn,onSuccess(o,s){var a,e;!o.success||(a=o.data)!=null&&a.message&&(he("SUCCESS",(e=o.data)==null?void 0:e.message),r.refetchQueries([T.LIST]),r.refetchQueries([T.DETAIL,s.carer_id]),Promise.all(s.data.map(m=>r.refetchQueries([B.DETAIL,m.patient_id]))),r.refetchQueries([T.LIST_PATIENT_ASSIGNED]))},onError:o=>{ce(o)},...t})};function Yn(t){return ge(V({url:T.LIST_PATIENT_ASSIGNED,method:"get",params:t}))}function Bn({caretakerId:t,configs:r}){var A,g;const o=W(),{queryParams:s,...a}=xn(),{data:e,...m}=fe({...r,queryFn:()=>Yn({carer_id:t,...s}),queryKey:[T.LIST_PATIENT_ASSIGNED,t,s]}),C=k.exports.useMemo(()=>{var _;return(_=e==null?void 0:e.patients)==null?void 0:_.data},[(A=e==null?void 0:e.patients)==null?void 0:A.data]),u=k.exports.useMemo(()=>{var _;return(_=e==null?void 0:e.patients)==null?void 0:_.paging},[(g=e==null?void 0:e.patients)==null?void 0:g.paging]);function i(){o.refetchQueries([T.LIST_PATIENT_ASSIGNED,t,s])}return{queryParams:s,patientsListAssignCaretaker:C,patientsAssignCaretakerPaging:u,...a,...m,invalidateQueryGetListPatientListAssignCaretaker:i}}const Wn=t=>V({url:T.CARERS_UNASSIGN_PATIENT,method:"POST",data:t}),On=({configs:t}={})=>{const r=W();return pe({mutationFn:Wn,onSuccess(o,s){var a,e;!o.success||((a=o.data)!=null&&a.message&&he("SUCCESS",(e=o.data)==null?void 0:e.message),r.refetchQueries([T.LIST],{type:"all"}),r.refetchQueries([T.DETAIL,s.carer_id],{type:"all"}),r.refetchQueries([B.DETAIL,s.patient_id],{type:"all"}),r.refetchQueries([T.LIST_PATIENT_ASSIGNED],{type:"all"}))},onError:o=>{ce(o)},...t})},Xe=yn.extend({email:Tn}),De=Xe.partial(),Ze=D.object({data:D.array(D.object({patient_id:D.number({required_error:"Patient is required"}).min(1,"Patient is required"),relationship_id:D.number({required_error:"Relationship is required"}).min(1,"Relationship is required")}))}),$n=({info:t,onSelected:r,...o})=>h(S,{px:"16px",justify:"space-between",direction:"row",...o,children:[h(S,{direction:"row",align:"center",spacing:"12px",children:[n(J,{src:t.avatar}),n(N,{color:"secondary",sx:{fontWeight:"700",fontSize:"14px",lineHeight:"120%"},children:t.name})]}),n(S,{bg:t.checked?"primary":"neutral.300",h:"32px",w:"32px",rounded:"full",cursor:"pointer",align:"center",justify:"center",onClick:()=>r(t),children:n(Sn,{})})]}),jn=({info:t,onDeleteSelectItem:r})=>h(S,{px:3,py:2,align:"center",direction:"row",spacing:3,bg:"neutral.600",rounded:"4px",children:[n(N,{color:"primary",sx:{fontWeight:"700",fontSize:"12px",lineHeight:"120%"},children:t.name}),n(N,{cursor:"pointer",color:"neutral.300",fontSize:"12px",onClick:()=>r(t.id),children:"X"})]}),en=be.memo(({caretakerId:t,onAssignIds:r})=>{var _,E;const{t:o}=O(["common","careTakers"]),{patientsListAssignCaretaker:s,isLoading:a,queryParams:e,patientsAssignCaretakerPaging:m,setQuery:C}=Bn({caretakerId:t}),[u,i]=k.exports.useState([]);k.exports.useEffect(()=>{var b;const d=(b=s==null?void 0:s.filter(({is_assigned:c})=>c).map(c=>{var P,y;return{avatar:c==null?void 0:c.avatar,id:(P=c==null?void 0:c.id)!=null?P:0,name:j({firstName:c==null?void 0:c.first_name,middleName:c==null?void 0:c.middle_name,lastName:c==null?void 0:c.last_name}),checked:(y=c.is_assigned)!=null?y:!1,relationshipId:c.relationship.id}}))!=null?b:[];i(c=>[...new Map(c.concat(d).map(P=>[P.id,P])).values()])},[s]),k.exports.useEffect(()=>{r&&r(u)},[u,r]);const A=d=>{i(b=>{if(b.find(({id:y})=>y===d.id))return b.map(y=>y.id===d.id?{...y,checked:!y.checked}:y).filter(({checked:y})=>y);const P={...d,checked:!0};return[...b,P]})},g=d=>{i(b=>b.filter(c=>c.id!==d))};return h(S,{children:[n(we,{isDisabled:a,initValue:e==null?void 0:e.keyword,onHandleSearch:d=>{C({page:1,keyword:d})}}),u.length>0&&h(Y,{children:[n(N,{sx:{fontWeight:"700",fontSize:"12px",lineHeight:"120%"},my:2,color:"neutral.300",children:`${o("careTakers:caretaker-form.selected")} (${u.length})`}),n(S,{direction:"row",align:"center",gap:2,flexFlow:"wrap",children:u.map((d,b)=>d.checked?n(Y,{pl:b===0?2:0,children:n(jn,{info:d,onDeleteSelectItem:g})},d.id):null)})]}),h(ae.Avatar,{isLoaded:!a,count:5,children:[h(S,{spacing:"16px",minH:"120px",children:[(s==null?void 0:s.length)&&h(K,{children:[n(N,{color:"neutral.300",sx:{fontWeight:"700",fontSize:"12px",lineHeight:"120%"},pt:"16px",textTransform:"uppercase",children:o("common:suggestion")}),n(S,{spacing:"16px",children:s==null?void 0:s.map(d=>{var b,c;return n($n,{info:{avatar:d.avatar,id:d.id,name:j({firstName:d==null?void 0:d.first_name,middleName:d==null?void 0:d.middle_name,lastName:d==null?void 0:d.last_name}),checked:(c=(b=u.find(P=>P.id===d.id))==null?void 0:b.checked)!=null?c:!1},onSelected:A},d.id)})})]}),!(s!=null&&s.length)&&!a&&n(N,{textAlign:"center",fontWeight:"bold",my:"auto",fontSize:20,children:o("common:no_data")})]}),n(S,{direction:"row",mt:"4",justify:"flex-end",align:"center",spacing:"6",px:4,children:n(An,{currentPage:(_=m==null?void 0:m.current_page)!=null?_:1,perPage:Number(m==null?void 0:m.per_page),totalCount:(E=m==null?void 0:m.total)!=null?E:1,onPageChange:d=>C({page:d})})})]})]})}),ye=be.memo(()=>{const t=He(),{t:r}=O(["common","careTakers"]),{register:o,formState:s,control:a}=t,{errors:e,defaultValues:m,isSubmitting:C}=s,u=t.getValues("avatar")instanceof File?void 0:String(t.getValues("avatar"));return h(S,{pt:"8px",children:[n(In,{initUrl:u,control:a,name:"avatar",error:e==null?void 0:e.avatar,trigger:()=>n(M,{w:"169px",color:"secondary",fontWeight:700,size:"lg",variant:"ghost",leftIcon:n(rn,{}),isDisabled:C,children:r("common:upload_photo")}),children:i=>n(J,{boxSize:"100px",src:i})}),h(on,{templateColumns:"repeat(2, 1fr)",gap:4,children:[n(w,{colSpan:{base:2,md:1},children:n(F,{label:r("common:info.first_name"),isRequired:!0,placeholder:r("common:info.form.enter_first_name"),registration:o("first_name"),error:e.first_name})}),n(w,{colSpan:{base:2,md:1},children:n(F,{label:r("common:info.middle_name"),isRequired:!0,placeholder:r("common:info.form.enter_middle_name"),registration:o("middle_name"),error:e.middle_name})}),n(w,{colSpan:{base:2,md:1},children:n(F,{label:r("common:info.last_name"),isRequired:!0,placeholder:r("common:info.form.enter_last_name"),registration:o("last_name"),error:e.last_name})}),n(w,{colSpan:{base:2,md:1},children:n(Ce,{options:Re,label:r("common:info.gender"),isRequired:!0,placeholder:m!=null&&m.gender?void 0:r("common:please_select"),registration:o("gender",{valueAsNumber:!0}),error:e.gender})}),n(w,{colSpan:{base:2,md:1},children:n(F,{label:r("common:info.date_of_birth"),isRequired:!0,placeholder:r("common:info.form.enter_date"),type:"date",registration:o("birthday"),error:e.birthday})}),n(w,{colSpan:{base:2,md:1},children:n(Ye,{name:"phone",control:a,render:({field:{value:i,onChange:A,...g}})=>n(F,{label:r("common:info.phone_number"),placeholder:"012-345-6789",isRequired:!0,error:e==null?void 0:e.phone,value:i!=null?i:"",maxLength:12,onChange:_=>{A(sn(_.target.value))},...g})})}),n(w,{colSpan:2,children:n(F,{label:r("common:info.email"),placeholder:r("common:info.form.enter_email"),registration:o("email"),error:e.email})}),n(w,{colSpan:2,children:n(qe,{variant:"title",children:r("common:info.address")})}),n(w,{colSpan:2,children:n(F,{label:r("common:info.street_address"),isRequired:!0,placeholder:r("common:info.form.enter_street_address"),registration:o("street"),error:e==null?void 0:e.street})}),n(w,{colSpan:{base:2,lg:1},children:n(F,{label:r("common:info.city"),placeholder:r("common:info.form.enter_city"),isRequired:!0,registration:o("city"),error:e==null?void 0:e.city})}),n(w,{colSpan:{base:2,lg:1},children:n(F,{label:r("common:info.state"),placeholder:r("common:info.form.enter_state"),isRequired:!0,registration:o("state"),error:e==null?void 0:e.state})}),n(w,{colSpan:{base:2,lg:1},children:n(F,{type:"number",label:r("common:info.zip_code"),placeholder:r("common:info.form.enter_zip_code"),isRequired:!0,registration:o("zip_code"),error:e==null?void 0:e.zip_code,minLength:4,maxLength:10})}),n(w,{colSpan:{base:2,lg:1},children:n(F,{label:r("common:info.country"),placeholder:r("common:info.form.enter_country"),isRequired:!0,registration:o("country"),error:e==null?void 0:e.country})})]})]})});function Kn({patientList:t}){const{relationshipList:r,isLoading:o}=Qn(),{t:s}=O(["common","careTakers"]),{formState:a,control:e,getValues:m,reset:C,register:u}=He(),{errors:i}=a,{fields:A}=Pn({control:e,name:"data"});return k.exports.useEffect(()=>{t.length>0&&!o&&C({data:t.map(g=>({patient_id:g.id,relationship_id:g.relationshipId}))})},[t,C,o]),n(ae.Avatar,{isLoaded:!o,count:3,children:n(S,{spacing:4,children:!!(t!=null&&t.length)&&!!A.length&&A.map((g,_)=>{var E,d;return h(S,{direction:"row",justify:"space-between",align:"center",children:[h(S,{direction:"row",spacing:3,flex:1,align:"center",children:[n(J,{boxSize:10,src:(E=t[_])==null?void 0:E.avatar}),n(N,{fontWeight:700,children:(d=t[_])==null?void 0:d.name})]}),n("input",{hidden:!0,...u(`data.${_}.patient_id`,{valueAsNumber:!0})}),n(Y,{w:"180px",children:n(Ye,{name:`data.${_}.relationship_id`,control:e,render:({field:b})=>{var c,P,y,R,p,l;return n(Ce,{placeholder:(P=(c=m("data"))==null?void 0:c[_])!=null&&P.relationship_id?void 0:s("common:please_select"),options:(y=r==null?void 0:r.map(({name:I,id:x})=>({label:I,value:x})))!=null?y:[],error:(p=(R=i==null?void 0:i.data)==null?void 0:R[_])==null?void 0:p.relationship_id,...b,value:(l=b.value)!=null?l:void 0,onChange:I=>{b.onChange(Number(I.target.value))}})}})})]},g.id)})})})}const nn=be.memo(Kn);function Vn({isLoading:t=!1,onQueryChange:r,queryParams:o,resetQuery:s}){var Q,$,te,G;const{t:a}=O(["careTakers","common"]),e=Un(),m=W(),C=ee({schema:Xe,options:{defaultValues:{birthday:void 0}}}),u=ee({schema:Ze}),{reset:i}=u,[A,g]=k.exports.useState([]),_=k.exports.useMemo(()=>A,[A]),E=k.exports.useCallback(g,[g]),{step:d,next:b,isFirstStep:c,currentStepIndex:P,isLastStep:y,resetStep:R,back:p}=Be([n(ye,{}),n(en,{caretakerId:(G=(te=($=(Q=e.data)==null?void 0:Q.data)==null?void 0:$.carer)==null?void 0:te.id)!=null?G:0,onAssignIds:E},"AssignPatientsToCaretakerCard"),n(nn,{patientList:_})]);function l(L){const H={...L,birthday:Z({date:L.birthday,format:"YYYY-MM-DD"})};e.mutate(H,{onSuccess(){b(),C.reset(),s()}})}const I=Je();function x(L){var re,oe,X;const H=(X=(oe=(re=e==null?void 0:e.data)==null?void 0:re.data)==null?void 0:oe.carer)==null?void 0:X.id;(L==null?void 0:L.data.length)>0&&H&&I.mutate({carer_id:H,data:L.data},{onSuccess(){m.refetchQueries([T.DETAIL,H]),E([]),u.reset(),u.clearErrors()}})}k.exports.useEffect(()=>{_&&i({data:_.map(L=>({patient_id:L.id}))})},[_,i]);function v(){return c?a("careTakers:add_new_member"):P===1?a("careTakers:caretaker-form.assign_patient_to_caretaker"):y?a("careTakers:caretaker-form.relationship_with_patient"):""}return h(S,{p:4,bg:"white",direction:{base:"column",md:"row"},justify:"space-between",align:"center",children:[n(S,{w:{base:"full",lg:"70%"},children:h(S,{alignItems:"center",w:"full",direction:{base:"column",md:"row"},children:[n(Y,{flex:1,w:"full",children:n(Ce,{isDisabled:t,options:[{label:"All genders",value:0}].concat(Re),value:o.gender,onChange:L=>Number(L.target.value)===0?r({gender:void 0}):r({page:1,gender:Number(L.target.value)})})}),n(Y,{flex:3,w:"full",children:n(we,{isDisabled:t,placeholder:a("common:table.search_by_name_email"),onHandleSearch:L=>{r({page:1,keyword:L})}})})]})}),n(se,{allowedRoles:an,children:n(En,{title:v(),triggerBtn:()=>n(M,{bg:"primary",color:"white",leftIcon:n(cn,{}),size:{base:"lg",md:"lg"},flexShrink:0,isDisabled:e.isLoading||t,children:n(N,{fontSize:"16px",color:"white",children:a("careTakers:add_new_member")})}),isDone:I.isSuccess,renderFooter:()=>y?n(M,{w:"348px",size:"lg",type:"submit",form:"assign-patient-caretaker",isLoading:I.isLoading,isDisabled:I.isLoading,children:a("common:submit")}):P===1?n(M,{w:"348px",size:"lg",type:"button",isDisabled:!_.length,onClick:L=>{L.preventDefault(),b()},children:a("common:next")}):n(M,{w:"348px",size:"lg",type:"submit",form:"add-caretaker",isLoading:e.isLoading,isDisabled:e.isLoading,children:a("common:next")}),onBeforeTrigger:()=>{R(),C.reset(),C.clearErrors()},onHandleBack:c?void 0:p,children:n(Y,{mt:4,children:c?n(ne,{form:C,id:"add-caretaker",onSubmit:l,children:d}):n(ne,{form:u,id:"assign-patient-caretaker",onSubmit:x,children:d})})})})]})}function _t(){const{t}=O(["common","careTakers"]),{checkAccess:r}=dn(),{caretakersList:o,caretakersPaging:s,queryParams:a,setQuery:e,resetQuery:m,invalidateQueryCaretakersList:C,...u}=Cn(),i=W(),A=ze(),g=k.exports.useMemo(()=>[{header:"User",columns:[{key:"middle_name",title:"NO",Cell(p,l=0){return n(N,{fontWeight:"semibold",children:l+1})}},{key:"avatar",title:t("careTakers:users").toUpperCase(),Cell:({id:p,avatar:l,phone:I,...x})=>n(Ke,{to:r({allowedRoles:ln})?`${p}`:"",children:h(S,{direction:"row",children:[n(J,{src:l,boxSize:"40px",rounded:"full"}),h(ve,{direction:"column",children:[j({firstName:x==null?void 0:x.first_name,middleName:x==null?void 0:x.middle_name,lastName:x==null?void 0:x.last_name}),n(N,{color:"primary",children:I})]})]})})},{key:"gender",title:t("common:info.gender").toUpperCase()},{key:"email",title:t("common:info.email_address").toUpperCase()},{key:"state",title:t("common:table.status").toUpperCase(),Cell({user_id:p,status:l}){return r({allowedRoles:le})?n(Ln,{userId:p,initActive:l?!!mn[l]:void 0,onSuccess:()=>{C()}}):n(un,{colorScheme:l?"green":"red",rounded:4,children:t(l?"common:table.active":"common:table.inactive")})}}]}],[r,C,t]),_=me(),E=Qe(),d=Se(),b=ee({schema:De}),{reset:c,isDirtyField:P}=b;function y(p,l){const I=ie({...p,birthday:Z({date:Me(p.birthday),format:"YYYY-MM-DD"}),id:l==null?void 0:l.user_id,zip_code:Number(p.zip_code)});E.mutate(I,{onSuccess(){var v,Q;C(),i.refetchQueries([T.DETAIL,l==null?void 0:l.id],{type:"all"});const x=(Q=(v=l==null?void 0:l.patients)==null?void 0:v.map($=>i.refetchQueries([B.DETAIL,$.id],{type:"all"})))!=null?Q:[];Promise.all(x)}})}function R(p){A.mutate(p==null?void 0:p.user_id,{onSuccess:async()=>{var I,x;C(),i.removeQueries([T.DETAIL,p==null?void 0:p.id],{type:"all"});const l=(x=(I=p==null?void 0:p.patients)==null?void 0:I.map(v=>i.refetchQueries([B.DETAIL,v.id],{type:"all"})))!=null?x:[];Promise.all(l)}})}return h(K,{children:[n($e,{title:t("careTakers:caretaker_management")}),h(S,{children:[n(Vn,{resetQuery:m,isLoading:u.isLoading,queryParams:a,onQueryChange:p=>{e({...p})}}),n(Ge,{currentPage:s==null?void 0:s.current_page,perPage:Number(s==null?void 0:s.per_page),data:o!=null?o:[],groupColumns:g,totalCount:s==null?void 0:s.total,maxWidthColumn:185,isLoading:u.isLoading,error:u.isError,additionalFeature:r({allowedRoles:le})?({...p})=>n(je,{menuItems:[{label:t("careTakers:caretaker-list.edit_caretaker_info"),icon:n(We,{}),onClick:()=>{var l;c(ie({...p,gender:Fe[p.gender],birthday:Z({date:p.birthday,format:"YYYY-MM-DD"})})),(l=_.current)==null||l.openModal()}},{label:t("careTakers:caretaker_details.delete_caretaker"),icon:n(kn,{}),onClick:()=>{var l;(l=d.current)==null||l.show()}}],children:l=>h(K,{children:[n(Oe,{isOpen:l}),n(Te,{ref:d,isDone:A.isSuccess,isLoading:A.isLoading,onHandleConfirm:()=>R(p)}),n(ue,{ref:_,isDone:E.isSuccess,title:t("careTakers:caretaker-form.update_caretaker"),renderFooter:()=>n(M,{w:"348px",size:"lg",type:"submit",form:"update-caretaker",isLoading:E.isLoading,isDisabled:!P||E.isLoading,children:t("common:save")}),onBeforeClose:()=>{b.reset(),b.clearErrors(),E.reset()},children:n(ne,{form:b,id:"update-caretaker",onSubmit:I=>y(I,p),children:n(ye,{})})})]})}):void 0,onPageChange:(p,l)=>e({page:p,per_page:l})})]})]})}const Jn=()=>{const{id:t}=Ue(),{t:r}=O(["careTakers","common"]),{patientsOfCaretaker:o,isLoading:s,isError:a}=Ve({id:Number(t)}),e=k.exports.useMemo(()=>[{header:"User",columns:[{key:"special_id",title:"ID",Cell({special_id:u}){return n(N,{textAlign:"left",children:u})}},{key:"avatar",title:r("common:table.patient").toUpperCase(),Cell:({id:u,avatar:i,phone:A,...g})=>h(S,{direction:"row",cursor:"pointer",children:[n(J,{src:i,boxSize:"40px",rounded:"full"}),h(ve,{direction:"column",children:[n(Ke,{to:`${_e.PATIENTS_MANAGEMENT}/${u}`,noOfLines:2,children:j({firstName:g==null?void 0:g.first_name,middleName:g==null?void 0:g.middle_name,lastName:g==null?void 0:g.last_name})}),n(N,{color:"primary",children:A})]})]})},{key:"relationship",title:r("common:table.relationship").toUpperCase()},{key:"gender",title:r("common:info.gender").toUpperCase()},{key:"birthday",title:r("common:info.d_o_b").toUpperCase()},{key:"type",title:r("common:table.group").toUpperCase(),Cell({type:u}){return n(N,{color:"primary",textAlign:"left",children:pn[u]})}}]}],[r]),m=On(),C=Se();return n(Ge,{perPage:o==null?void 0:o.length,data:o!=null?o:[],groupColumns:e,totalCount:o==null?void 0:o.length,isLoading:s||m.isLoading,error:a,hasNoPaginate:!0,additionalFeature:({id:u})=>n(je,{menuItems:[{label:"Unassign",icon:n(We,{}),onClick(){var i;(i=C.current)==null||i.show()}}],children:i=>h(K,{children:[n(Oe,{isOpen:i}),n(Te,{ref:C,isLoading:m.isLoading,isDone:m.isSuccess,title:"Unassign confirm?",textConfirm:"Unassign",onHandleConfirm:()=>m.mutate({patient_id:u,carer_id:Number(t)})})]})})})},bt=()=>{var X,xe,Ae,Pe,Ie,ke,Ee,Le;const{t}=O(["careTakers","common"]),r=W(),o=Ne(),s=me(),{id:a}=Ue(),{caretakerDetail:e,isLoading:m,refetch:C}=Ve({id:Number(a),shouldNavigateNotFound:!0}),u=j({firstName:e==null?void 0:e.first_name,middleName:e==null?void 0:e.middle_name,lastName:e==null?void 0:e.last_name}),i=k.exports.useMemo(()=>{var f,q,U,z;return[{label:t("common:info.full_name"),text:u},{label:t("common:info.date_of_birth"),text:(f=e==null?void 0:e.birthday)!=null?f:""},{label:t("common:info.gender"),text:String(e==null?void 0:e.gender)},{label:t("common:info.email_address"),text:(q=e==null?void 0:e.email)!=null?q:""},{label:t("common:info.phone_number"),text:(U=e==null?void 0:e.phone)!=null?U:""},{label:t("common:info.zip_code"),text:(z=e==null?void 0:e.zip_code)!=null?z:""},{label:t("common:info.address"),text:hn({city:e==null?void 0:e.city,state:e==null?void 0:e.state,country:e==null?void 0:e.country,zipCode:e==null?void 0:e.zip_code,street:e==null?void 0:e.street})}]},[e,u,t]),A=k.exports.useMemo(()=>[{title:t("careTakers:caretaker_details.caretaker_info").toUpperCase(),children:n(S,{spacing:4,children:h(S,{pb:6,spacing:6,children:[n(qe,{variant:"title",children:t("common:info.profile_information")}),n(ae,{children:n(ae.Card,{isLoaded:!m,noOfLines:4,children:n(Nn,{infoData:i})})})]})})},{title:t("careTakers:caretaker_details.assigned_patient"),children:n(Jn,{})}],[i,m,t]),g=me(),_=Se(),E=ee({schema:De}),{reset:d,isDirtyField:b}=E,c=Qe(),P=ze();function y(f){c.mutate(ie({...f,id:e==null?void 0:e.user_id,zip_code:String(f.zip_code),birthday:Z({date:Me(f.birthday),format:"YYYY-MM-DD"})}),{onSuccess(){var U,z;r.refetchQueries([T.LIST]);const q=(z=(U=e==null?void 0:e.patients)==null?void 0:U.map(de=>r.refetchQueries([B.DETAIL,de.id],{type:"all"})))!=null?z:[];Promise.all(q),C()}})}const R=Je(),[p,l]=k.exports.useState([]),I=k.exports.useMemo(()=>p,[p]),x=k.exports.useCallback(l,[l]),v=ee({schema:Ze,options:{shouldUnregister:!0}}),{reset:Q}=v;function $(f){const q=e==null?void 0:e.id;(f==null?void 0:f.data.length)>0&&q&&R.mutate({carer_id:q,data:f.data},{onSuccess(U,z){r.refetchQueries([T.DETAIL,q]),r.refetchQueries([T.LIST_PATIENT_ASSIGNED,q]);const de=z.data.map(tn=>r.refetchQueries([B.DETAIL,tn.patient_id]));Promise.any(de),x([]),v.reset(),v.clearErrors()}})}const{step:te,isLastStep:G,next:L,resetStep:H,back:re,isFirstStep:oe}=Be([n(en,{caretakerId:(X=e==null?void 0:e.id)!=null?X:0,onAssignIds:x},"AssignPatientsToCaretakerCard"),I.length>0?n(nn,{patientList:I},"RelationShipPatientsForm"):n(K,{children:" "})]);return h(K,{children:[n($e,{title:u}),h(S,{direction:{base:"column-reverse",lg:"row"},spacing:6,align:"flex-start",children:[n(wn,{maxW:{base:"full",lg:"70%"},children:n(qn,{tabData:A})}),n(Rn,{isLoading:!m,avatar:e==null?void 0:e.avatar,location:"",title:u,roleType:"Caretaker",children:n(S,{pt:4,borderTop:"1px",borderColor:"neutral.500",children:h(S,{spacing:4,children:[h(S,{direction:"row",spacing:10,align:"center",children:[h(S,{direction:"row",children:[n(fn,{boxSize:"40px",spacing:"-1.3rem",children:!!((xe=e==null?void 0:e.patients)!=null&&xe.length)&&((Ae=e==null?void 0:e.patients)==null?void 0:Ae.slice(0,4).map(f=>n(J,{boxSize:10,name:j({firstName:f.first_name,middleName:f.middle_name,lastName:f.last_name}),src:f.avatar},f.id)))}),!((Pe=e==null?void 0:e.patients)!=null&&Pe.length)&&n(N,{children:t("careTakers:caretaker_details.unassigned")})]}),!!((Ie=e==null?void 0:e.patients)!=null&&Ie.length)&&n(N,{pl:10,children:`${(ke=e==null?void 0:e.patients)==null?void 0:ke.length} ${t("common:patients")}`})]}),n(se,{allowedRoles:gn,children:h(M,{size:"lg",isDisabled:m,leftIcon:n(vn,{}),fontSize:{base:"15px",md:"16px"},onClick:()=>{var f;return(f=s.current)==null?void 0:f.openModal()},children:[`${(Ee=e==null?void 0:e.patients)!=null&&Ee.length?t("careTakers:caretaker_details.edit_assign"):t("careTakers:caretaker_details.assign")} ${t("careTakers:caretaker_details.patient_to_caretaker")}`,n(ue,{ref:s,title:G?t("careTakers:caretaker-form.relationship_with_patient"):`${(Le=e==null?void 0:e.patients)!=null&&Le.length?t("careTakers:caretaker_details.edit_assign"):t("careTakers:caretaker_details.assign")}${t("careTakers:caretaker_details.patient_to_caretaker")}`,isDone:R.isSuccess,renderFooter:()=>n(M,{w:"348px",size:"lg",type:G?"submit":"button",isLoading:R.isLoading,isDisabled:!p.length||R.isLoading,form:"form-assign-patients-to-caretaker",onClick:f=>{!G&&f.preventDefault(),L()},children:t(G?"common:submit":"common:next")}),onBeforeClose:()=>{R.reset(),Q(),E.clearErrors(),H()},onHandleBack:oe?void 0:re,children:n(ne,{form:v,id:"form-assign-patients-to-caretaker",onSubmit:$,children:n(Y,{w:"full",pt:4,children:te})})})]})}),n(se,{allowedRoles:le,children:h(M,{size:"lg",isDisabled:m,variant:"ghost",fontSize:{base:"15px",md:"16px"},leftIcon:n(_n,{}),onClick:()=>{var f;e&&d(ie({...e,birthday:Z({date:e.birthday,format:"YYYY-MM-DD"}),gender:e!=null&&e.gender?Fe[e.gender]:void 0})),(f=g.current)==null||f.openModal()},children:[t("careTakers:caretaker_details.edit_caretaker_profile"),e&&n(ue,{ref:g,isDone:c.isSuccess,title:t("careTakers:caretaker-form.update_caretaker"),renderFooter:()=>n(M,{w:"348px",size:"lg",type:"submit",form:"update-caretaker",isLoading:c.isLoading,disabled:!b||c.isLoading,children:t("common:submit")}),onBeforeClose:()=>{c.reset()},children:n(ne,{form:E,id:"update-caretaker",onSubmit:y,children:n(ye,{})})})]})}),n(se,{allowedRoles:bn,children:h(M,{leftIcon:n(Fn,{}),size:"lg",fontSize:{base:"15px",md:"16px"},isDisabled:m,variant:"ghost",onClick:()=>{var f;return(f=_.current)==null?void 0:f.show()},children:[t("careTakers:caretaker_details.delete_caretaker"),e&&n(Te,{ref:_,isLoading:P.isLoading,onHandleConfirm:()=>P.mutate(e==null?void 0:e.user_id,{onSuccess:async()=>{var q,U;o(_e.CARETAKERS),r.refetchQueries([T.LIST]),r.removeQueries([T.DETAIL,a],{type:"all"});const f=(U=(q=e==null?void 0:e.patients)==null?void 0:q.map(z=>r.refetchQueries([B.DETAIL,z.id],{type:"all"})))!=null?U:[];Promise.all(f)}})})]})})]})})})]})]})};export{bt as CaretakersDetailPage,_t as CaretakersListPage};
