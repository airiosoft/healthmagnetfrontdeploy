import{ab as W,ac as G,ad as $,ae as J,af as O,r as x,a as e,j as h,S as y,B as Y,f as K,bI as V,g as X,as as S,au as F,aG as Z,T as N,aI as D,k as ee,i as te,A as se,F as re,at as oe,aM as ae,U as B,aH as ne,aP as ie,l as ce,M as de,aS as le}from"./index.b3b82eb3.js";import{C as E}from"./clinic-team-endpoint.08333932.js";import{u as ue}from"./get-list-clinic-team.api.8be6c742.js";import{u as me,P as pe}from"./patient-endpoint.36464126.js";import{u as Q}from"./confirm-password.validation.fea8be59.js";import{c as fe,u as he,C as q,A as ge,a as Ce}from"./clinic-team-form.84be3c06.js";import{u as _e,A as be,b as Ae,c as Se}from"./additional-feature.294219f4.js";import{M as ye}from"./modal-base.91f8d918.js";import{F as z}from"./form.5084ebc2.js";import{u as j,a as Ee}from"./profile.validation.ad7e7eae.js";import{H as Ie}from"./Head.663b461a.js";import{C as Le,M as Me}from"./change-status-user.9246f232.js";import{C as xe}from"./chakra-link.98b662c1.js";import{T as Fe}from"./table.1bced37e.js";import"./file-upload.7eb0e642.js";import"./slicedToArray.dcf7c84f.js";import"./popper.824c9986.js";import"./index.esm.2b6ea95a.js";const Ne="accounts/create-account",Pe=r=>J({url:Ne,method:"POST",data:r}),ke=({configs:r}={})=>W({mutationFn:o=>Pe(o),onSuccess(o){var n;o.success&&((n=o==null?void 0:o.data)==null?void 0:n.message)&&G("SUCCESS",o.data.message)},onError:o=>{$(o)},...r}),we=ke;function Ue({isLoading:r=!1,onQueryChange:o,queryParams:n,resetQuery:I}){var t,s,m,i,T;const{t:d}=j(["common","clinic"]),l=O(),g=Q({schema:fe}),a=we();function p(c){const M={...c,birthday:D({date:c.birthday,format:"YYYY-MM-DD"})};a.mutate(M,{onSuccess(A){l.refetchQueries([E.LIST]),(A.data.user_info.role_type===S.Doctor||A.data.user_info.role_type===S.ARNP)&&U(),g.reset(),I()}})}const u=he(),[C,b]=x.exports.useState([]),f=x.exports.useMemo(()=>C,[C]),_=x.exports.useCallback(b,[b]);function P(){var M,A,R,v;const c=(v=(R=(A=(M=a.data)==null?void 0:M.data)==null?void 0:A.user_info)==null?void 0:R.user_id)!=null?v:0;!f.length||u.mutate({user_id:c,patient:f.length?f.map(({id:H})=>H):[]},{onSuccess(){l.refetchQueries([E.DETAIL,c]),l.refetchQueries([E.LIST_PATIENT_ASSIGN_CLINIC])}})}const{step:k,resetStep:w,next:U,isLastStep:L}=_e([e(q,{},"ClinicTeamForm"),e(ge,{limitSelect:5,userId:(m=(s=(t=a==null?void 0:a.data)==null?void 0:t.data)==null?void 0:s.user_info.user_id)!=null?m:0,onAssignIds:_},"AssignPatientsToCaretakerToDoctorOrARNPCard")]);return e(z,{form:g,title:"form add clinic team",id:"add clinic team",onSubmit:p,children:h(y,{p:4,bg:"white",direction:{base:"column",md:"row"},justify:"space-between",align:"center",borderRadius:8,children:[e(y,{w:{base:"full",lg:"60%"},children:h(y,{align:"center",spacing:"16px",display:"flex",w:"full",direction:{base:"column",md:"row"},children:[e(Y,{flex:1,w:"full",children:e(K,{isDisabled:r,options:[{label:"All roles",value:0}].concat(V),value:n.role,onChange:c=>Number(c.target.value)===0?o({role:void 0}):o({page:1,role:Number(c.target.value)})})}),e(Y,{flex:3,w:"full",children:e(X,{placeholder:d("common:table.search_by_name_email"),isDisabled:r,onHandleSearch:c=>{o({page:1,keyword:c})}})})]})}),e(ye,{isDone:u.isSuccess||((i=a.data)==null?void 0:i.data.user_info.role_type)===S.Nurse||((T=a.data)==null?void 0:T.data.user_info.role_type)===S.Attendant,title:d(L?"clinic:detail.assign_patient_to_doctor":"clinic:list.add_new_member"),triggerBtn:()=>e(F,{bg:"primary",flexShrink:0,leftIcon:e(Z,{}),mt:{base:2,lg:0},size:{base:"lg",md:"lg"},isDisabled:a.isLoading||r,children:e(N,{as:"span",fontSize:"16px",color:"white",children:d("clinic:list.add_new_member")})}),renderFooter:()=>L?e(F,{w:"348px",size:"lg",type:"button",isDisabled:!f.length||u.isLoading,onClick:P,children:d("common:submit")}):e(F,{w:"348px",size:"lg",type:"submit",form:"add clinic team",isLoading:a.isLoading,isDisabled:a.isLoading,children:d("common:save")}),onBeforeTrigger:()=>{w(),g.reset(),g.clearErrors(),a.reset(),u.reset()},children:k})]})})}function Xe(){const{t:r}=j(["common","clinic"]),{clinicTeamList:o,clinicTeamPaging:n,setQuery:I,queryParams:d,invalidateQueryClinicTeamList:l,resetQuery:g,...a}=ue(),p=Ee(),u=O(),C=me(),b=ee(),f=te(),_=Q({schema:Ce}),{isDirtyField:P,reset:k}=_;function w(t,s){p.mutate({...t,id:s==null?void 0:s.user_id,birthday:D({date:le(t.birthday),format:"YYYY-MM-DD"})},{onSuccess(){l(),u.refetchQueries([E.DETAIL,s==null?void 0:s.user_id])}})}function U(t){C.mutate(t.user_id,{onSuccess:async()=>{var s;l(),u.removeQueries([E.DETAIL,t==null?void 0:t.user_id]),(s=t==null?void 0:t.patients)==null||s.forEach(m=>{u.refetchQueries([pe.DETAIL,m.user_id])})}})}const L=x.exports.useMemo(()=>[{header:"User",columns:[{key:"user_id",title:"No",Cell(t,s=0){return e(N,{textAlign:"left",children:s+1})}},{key:"avatar",title:r("clinic:list.doctor/nurse").toUpperCase(),Cell:({user_id:t,phone:s,avatar:m,...i})=>e(xe,{to:`${t}`,children:h(y,{direction:"row",children:[e(se,{src:m,boxSize:"40px",rounded:"full"}),h(re,{direction:"column",children:[oe({firstName:i==null?void 0:i.first_name,middleName:i==null?void 0:i.middle_name,lastName:i==null?void 0:i.last_name}),e(N,{color:"primary",children:s})]})]})})},{key:"gender",title:r("common:info.gender").toUpperCase()},{key:"role",title:"ROLE",Cell({role:t}){return e(N,{color:"primary",children:t})}},{key:"email",title:r("common:info.email").toUpperCase()},{key:"hospital",title:r("common:info.hospital").toUpperCase()},{key:"state",title:r("common:table.status").toUpperCase(),Cell({user_id:t,status:s}){return e(Le,{userId:t,initActive:s?!!ae[s]:void 0,onSuccess:()=>{l()}})}}]}],[l,r]);return h(B,{children:[e(Ie,{title:r("clinic:clinic_management")}),h(y,{children:[e(Ue,{isLoading:a.isLoading,queryParams:d,resetQuery:g,onQueryChange:t=>{I({...t})}}),e(Fe,{currentPage:n==null?void 0:n.current_page,perPage:Number(n==null?void 0:n.per_page),data:o!=null?o:[],groupColumns:L,totalCount:n==null?void 0:n.total,isLoading:a.isLoading,maxWidthColumn:185,error:a.isError,additionalFeature:({...t})=>e(Me,{menuItems:[{label:r("clinic:list.edit_doctor_nurse_info"),icon:e(be,{}),onClick:()=>{var s;k(ne({...t,gender:ie[t.gender],birthday:D({date:t.birthday,format:"YYYY-MM-DD"}),role:S[t.role]})),(s=f.current)==null||s.openModal()}},{label:r("clinic:detail.delete_doctor/nurse"),icon:e(Ae,{}),onClick:()=>{var s;(s=b.current)==null||s.show()}}],children:s=>h(B,{children:[e(Se,{isOpen:s}),e(ce,{ref:b,isDone:C.isSuccess,isLoading:C.isLoading,onHandleConfirm:()=>U(t)}),e(de,{ref:f,isDone:p.isSuccess,title:r("clinic:update_clinic_team"),renderFooter:()=>e(F,{w:"348px",size:"lg",type:"submit",form:"update-clinic-team",isLoading:p.isLoading,isDisabled:!P||p.isLoading,children:r("common:save")}),onBeforeClose:()=>{_.reset(),_.clearErrors(),p.reset()},children:e(z,{form:_,id:"update-clinic-team",onSubmit:m=>w(m,t),children:e(q,{})})})]})}),onPageChange:(t,s)=>I({page:t,per_page:s})})]})]})}export{Xe as ClinicTeamPage};
